<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Despesas Públicas</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" />
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

  <style>
    /* Tamanho reduzido das fontes */
    .xsmall {
      font-size: 0.75rem;
    }

    /* Estilo minimalista para paginação */
    .dataTables_wrapper .dataTables_paginate {
      margin-top: 0.5rem;
      text-align: center !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      padding: 0.2rem 0.5rem !important;
      margin: 0 2px !important;
      font-size: 0.65rem !important;
      border-radius: 5px !important;
      background-color: #e9ecef !important;
      border: 1px solid #dee2e6 !important;
      color: #212529 !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background-color: #0d6efd !important;
      color: #fff !important;
      font-weight: bold !important;
    }

    /* Estilo para rolagem horizontal */
    .table-wrapper {
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container-fluid mt-4">
    <h5 class="mb-3">Consulta de Despesas Públicas</h5>

    <div class="row g-2 mb-3">
      <div class="col-md-2">
        <input type="text" id="filtroData" class="form-control form-control-sm" placeholder="Data (AAAA-MM-DD)" />
      </div>
      <div class="col-md-3">
        <input type="text" id="filtroFornecedor" class="form-control form-control-sm" placeholder="Fornecedor" />
      </div>
      <div class="col-md-3">
        <input type="text" id="filtroOrgao" class="form-control form-control-sm" placeholder="Órgão" />
      </div>
      <div class="col-md-2">
        <input type="text" id="filtroValorMin" class="form-control form-control-sm" placeholder="Valor Mínimo (R$)" />
      </div>
      <div class="col-md-2">
        <input type="text" id="filtroValorMax" class="form-control form-control-sm" placeholder="Valor Máximo (R$)" />
      </div>
    </div>

    <div class="table-wrapper">
      <table id="tabela" class="table table-bordered table-striped table-sm xsmall w-100" style="display:none;"></table>
    </div>
  </div>

  <script>
    let dataTable;

    function formatarValor(valor) {
      return parseFloat(valor).toLocaleString("pt-BR", {
        style: "currency",
        currency: "BRL",
      });
    }

    function formatarData(dataISO) {
      const [ano, mes, dia] = dataISO.split("-");
      return `${dia}/${mes}/${ano}`;
    }

    function aplicarFiltros() {
      const data = $("#filtroData").val().toLowerCase();
      const fornecedor = $("#filtroFornecedor").val().toLowerCase();
      const orgao = $("#filtroOrgao").val().toLowerCase();
      const valorMin = parseFloat($("#filtroValorMin").val().replace(",", "."));
      const valorMax = parseFloat($("#filtroValorMax").val().replace(",", "."));

      dataTable.rows().every(function () {
        const row = this.data();
        const dataRow = row[0].toLowerCase();
        const fornecedorRow = row[1].toLowerCase();
        const orgaoRow = row[2].toLowerCase();
        const valorRow = parseFloat(row[3].replace(/[R$\s.]/g, "").replace(",", "."));

        const matchData = !data || dataRow.includes(data);
        const matchFornecedor = !fornecedor || fornecedorRow.includes(fornecedor);
        const matchOrgao = !orgao || orgaoRow.includes(orgao);
        const matchValorMin = isNaN(valorMin) || valorRow >= valorMin;
        const matchValorMax = isNaN(valorMax) || valorRow <= valorMax;

        if (matchData && matchFornecedor && matchOrgao && matchValorMin && matchValorMax) {
          $(this.node()).show();
        } else {
          $(this.node()).hide();
        }
      });
    }

    $(document).ready(function () {
      // Carregamento do CSV local (substitua por seu próprio arquivo)
      $.get("dados.csv", function (csv) {
        const linhas = csv.trim().split("\n");
        const cabecalho = linhas[0].split(";");
        const dados = linhas.slice(1).map((linha) => {
          const colunas = linha.split(";");
          return [
            formatarData(colunas[0]),
            colunas[1],
            colunas[2],
            formatarValor(colunas[3].replace(",", ".")),
          ];
        });

        $("#tabela").show();

        dataTable = $("#tabela").DataTable({
          data: dados,
          columns: [
            { title: "Data" },
            { title: "Fornecedor" },
            { title: "Órgão" },
            { title: "Valor" },
          ],
          responsive: true,
          scrollX: true,
          pageLength: 30,
          language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.4/i18n/pt-BR.json",
          },
        });

        // Aplica filtros
        $("#filtroData, #filtroFornecedor, #filtroOrgao, #filtroValorMin, #filtroValorMax").on("input", aplicarFiltros);
      });
    });
  </script>
</body>
</html>
