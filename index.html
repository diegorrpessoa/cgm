<!--<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela Pública</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
    }
    h1 {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>DESPESAS 2025</h1>
  <table id="tabela" class="display" style="width:100%"></table>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
  Papa.parse('despesas_25.csv', {
    download: true,
    header: true,
    complete: function(results) {
      const data = results.data.filter(row => Object.values(row).some(val => val !== ""));
      const columns = Object.keys(data[0]).map(col => ({ title: col, data: col }));
      $('#tabela').DataTable({
        data: data,
        columns: columns,
        language: {
          url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
        },
        pageLength: 25
      });
    }
  });
</script>

</body>
</html>
-->
<!--<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Despesas - Filtro por Mês</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #filtros { margin-bottom: 1rem; }
    label { font-weight: bold; margin-right: 1rem; }
  </style>
</head>
<body>

  <h1>Despesas Mensais</h1>

  <div id="filtros">
    <label for="filtroMes">Filtrar por mês:</label>
    <select id="filtroMes">
      <!--<option value="">Todos os meses</option>-->
   <!-- </select>
  </div>

  <table id="tabela" class="display" width="100%"></table>

  <!-- Scripts -->
  <!--<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <script>
    Papa.parse('despesas_25.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data.filter(row => Object.values(row).some(val => val !== ""));
        const colunas = Object.keys(data[0]).map(col => ({ title: col, data: col }));

        const tabela = $('#tabela').DataTable({
          data: data,
          columns: colunas,
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
          }
        });

        // Extrair e preencher filtro de meses
        const meses = [...new Set(data.map(d => d.mes).filter(Boolean))].sort((a, b) => a - b);
        for (const m of meses) {
          $('#filtroMes').append(`<option value="${m}">${m}</option>`);
        }

        // Aplicar filtro
        $('#filtroMes').on('change', function () {
          const mesSelecionado = this.value;
          const idxMes = colunas.findIndex(c => c.title === "mes");
          tabela.column(idxMes).search(mesSelecionado, true, false).draw();
        });
      }
    });
  </script>
</body>
</html>
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela com Filtros Avançados Despesas 2025</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #filtros { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
    .filtro { display: flex; flex-direction: column; }
    label { font-weight: bold; margin-bottom: 0.25rem; }
    button { height: 38px; margin-top: 1.5rem; }
  </style>
</head>
<body>

  <h1>Consulta de Despesas 2025</h1>

  <div id="filtros">
    <div class="filtro">
      <label for="filtroAno">Ano</label>
      <select id="filtroAno"><option value="">Todos</option></select>
    </div>
    <div class="filtro">
      <label for="filtroMes">Mês</label>
      <select id="filtroMes"><option value="">Todos</option></select>
    </div>
    <div class="filtro">
      <label for="filtroUO">Unidade Orçamentária</label>
      <select id="filtroUO"><option value="">Todas</option></select>
    </div>
    <div class="filtro">
      <label for="filtroEmpenho">Empenho</label>
      <input type="text" id="filtroEmpenho" placeholder="Digite o nº do empenho">
    </div>
    <div class="filtro">
      <label for="filtroCNPJ">CPF/CNPJ</label>
      <input type="text" id="filtroCNPJ" placeholder="Digite o CPF/CNPJ">
    </div>
    <div class="filtro">
      <label for="dataInicio">Data do Empenho - De:</label>
      <input type="text" id="dataInicio" autocomplete="off">
    </div>
    <div class="filtro">
      <label for="dataFim">Até:</label>
      <input type="text" id="dataFim" autocomplete="off">
    </div>
    <div class="filtro">
      <button id="limparFiltros">Limpar Filtros</button>
    </div>
  </div>

  <table id="tabela" class="display" width="100%"></table>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>

  <script>
    $(function () {
      $("#dataInicio, #dataFim").datepicker({ dateFormat: "yy-mm-dd" });
    });

    Papa.parse('despesas_25.csv', {
      download: true,
      header: true,
      complete: function (results) {
        const data = results.data.filter(row => Object.values(row).some(val => val !== ""));
        const colunas = Object.keys(data[0]).map(col => ({ title: col, data: col }));

        const tabela = $('#tabela').DataTable({
          data: data,
          columns: colunas,
          language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json' }
        });

        function popularFiltro(id, campo) {
          const valores = [...new Set(data.map(d => d[campo]).filter(Boolean))].sort();
          for (const val of valores) {
            $(`#${id}`).append(`<option value="${val}">${val}</option>`);
          }
        }

        popularFiltro('filtroAno', 'ano');
        popularFiltro('filtroMes', 'mes');
        popularFiltro('filtroUO', 'unidade orcamentaria');

        // Aplicar filtros dropdowns
        $('#filtroAno, #filtroMes, #filtroUO').on('change', function () {
          const colunasMap = {
            filtroAno: 'ano',
            filtroMes: 'mes',
            filtroUO: 'unidade orcamentaria'
          };
          Object.entries(colunasMap).forEach(([id, campo]) => {
            const idx = colunas.findIndex(c => c.title === campo);
            const val = $(`#${id}`).val();
            tabela.column(idx).search(val, true, false);
          });
          tabela.draw();
        });

        // Filtros de texto
        $('#filtroEmpenho, #filtroCNPJ').on('keyup', function () {
          const idxEmpenho = colunas.findIndex(c => c.title === "empenho");
          const idxCNPJ = colunas.findIndex(c => c.title === "cpf-cnpj");
          tabela.column(idxEmpenho).search($('#filtroEmpenho').val(), true, false);
          tabela.column(idxCNPJ).search($('#filtroCNPJ').val(), true, false);
          tabela.draw();
        });

        // Filtro por data de empenho
        $.fn.dataTable.ext.search.push(function (settings, dataRow) {
          const idxData = colunas.findIndex(c => c.title === "data do empenho");
          const dataTexto = dataRow[idxData];
          if (!dataTexto) return true;

          const inicio = $('#dataInicio').val();
          const fim = $('#dataFim').val();

          if (!inicio && !fim) return true;

          const data = new Date(dataTexto);
          const startDate = inicio ? new Date(inicio) : null;
          const endDate = fim ? new Date(fim) : null;

          if ((startDate && data < startDate) || (endDate && data > endDate)) return false;
          return true;
        });

        $('#dataInicio, #dataFim').on('change', function () {
          tabela.draw();
        });

        // Limpar filtros
        $('#limparFiltros').on('click', function () {
          $('#filtros select, #filtros input').val('');
          tabela.search('').columns().search('').draw();
        });
      }
    });
  </script>
</body>
</html>
