<!--<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela Pública</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
    }
    h1 {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>DESPESAS 2025</h1>
  <table id="tabela" class="display" style="width:100%"></table>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
  Papa.parse('despesas_25.csv', {
    download: true,
    header: true,
    complete: function(results) {
      const data = results.data.filter(row => Object.values(row).some(val => val !== ""));
      const columns = Object.keys(data[0]).map(col => ({ title: col, data: col }));
      $('#tabela').DataTable({
        data: data,
        columns: columns,
        language: {
          url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
        },
        pageLength: 25
      });
    }
  });
</script>

</body>
</html>
-->
<!--<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela de Despesas - Filtro por Mês</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #filtros { margin-bottom: 1rem; }
    label { font-weight: bold; margin-right: 1rem; }
  </style>
</head>
<body>

  <h1>Despesas Mensais</h1>

  <div id="filtros">
    <label for="filtroMes">Filtrar por mês:</label>
    <select id="filtroMes">
      <!--<option value="">Todos os meses</option>-->
   <!-- </select>
  </div>

  <table id="tabela" class="display" width="100%"></table>

  <!-- Scripts -->
  <!--<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <script>
    Papa.parse('despesas_25.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data.filter(row => Object.values(row).some(val => val !== ""));
        const colunas = Object.keys(data[0]).map(col => ({ title: col, data: col }));

        const tabela = $('#tabela').DataTable({
          data: data,
          columns: colunas,
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
          }
        });

        // Extrair e preencher filtro de meses
        const meses = [...new Set(data.map(d => d.mes).filter(Boolean))].sort((a, b) => a - b);
        for (const m of meses) {
          $('#filtroMes').append(`<option value="${m}">${m}</option>`);
        }

        // Aplicar filtro
        $('#filtroMes').on('change', function () {
          const mesSelecionado = this.value;
          const idxMes = colunas.findIndex(c => c.title === "mes");
          tabela.column(idxMes).search(mesSelecionado, true, false).draw();
        });
      }
    });
  </script>
</body>
</html>
-->

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tabela com Filtros Inteligentes</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    #filtros { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
    .filtro { display: flex; flex-direction: column; }
    label { font-weight: bold; margin-bottom: 0.25rem; }
    button { height: 38px; margin-top: 1.5rem; }
  </style>
</head>
<body>
  <h1>Consulta de Despesas 2025</h1>
  <div id="filtros">
    <div class="filtro">
      <label for="filtroAno">Ano</label>
      <select id="filtroAno"><option value="">Todos</option></select>
    </div>
    <div class="filtro">
      <label for="filtroMes">Mês</label>
      <select id="filtroMes"><option value="">Todos</option></select>
    </div>
    <div class="filtro">
      <label for="filtroUO">Unidade Orçamentária</label>
      <select id="filtroUO"><option value="">Todas</option></select>
    </div>
    <div class="filtro">
      <label for="filtroEmpenho">Empenho</label>
      <input type="text" id="filtroEmpenho" placeholder="Digite o nº do empenho">
    </div>
    <div class="filtro">
      <label for="filtroCNPJ">CPF/CNPJ</label>
      <input type="text" id="filtroCNPJ" placeholder="Digite o CPF/CNPJ">
    </div>
    <div class="filtro">
      <label for="dataInicio">Data do Empenho - De:</label>
      <input type="text" id="dataInicio" autocomplete="off">
    </div>
    <div class="filtro">
      <label for="dataFim">Até:</label>
      <input type="text" id="dataFim" autocomplete="off">
    </div>
    <div class="filtro">
      <button id="limparFiltros">Limpar Filtros</button>
    </div>
  </div>
  <table id="tabela" class="display" width="100%"></table>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json"></script>
  <script>
    $.datepicker.setDefaults($.datepicker.regional['pt-BR'] = {
      closeText: 'Fechar', prevText: '<Anterior', nextText: 'Próximo>',
      currentText: 'Hoje', monthNames: ['Janeiro','Fevereiro','Março','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
      monthNamesShort: ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],
      dayNames: ['Domingo','Segunda','Terça','Quarta','Quinta','Sexta','Sábado'],
      dayNamesShort: ['Dom','Seg','Ter','Qua','Qui','Sex','Sáb'],
      dayNamesMin: ['D','S','T','Q','Q','S','S'],
      dateFormat: 'yy-mm-dd'
    });
    $(function () {
      $("#dataInicio, #dataFim").datepicker();
    });

    Papa.parse('despesas_25.csv', {
      download: true,
      header: true,
      complete: function (results) {
        let data = results.data.filter(row => Object.values(row).some(val => val !== ""));
        const colunas = Object.keys(data[0]).map(col => ({ title: col, data: col }));
        const tabela = $('#tabela').DataTable({
          data: data,
          columns: colunas,
          language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json' },
          initComplete: function () {
            atualizarFiltros();
          }
        });

        function atualizarFiltros() {
          atualizarDropdown('filtroAno', 'ano');
          atualizarDropdown('filtroMes', 'mes');
          atualizarDropdown('filtroUO', 'unidade orcamentaria');
        }

        function atualizarDropdown(id, campo) {
          const valEmpenho = $('#filtroEmpenho').val().toLowerCase();
          const valCNPJ = $('#filtroCNPJ').val().toLowerCase();
          const inicio = $('#dataInicio').val();
          const fim = $('#dataFim').val();

          let filtrado = data.filter(d => {
            let match = true;
            if (valEmpenho && !d['empenho'].toLowerCase().includes(valEmpenho)) match = false;
            if (valCNPJ && !d['cpf-cnpj'].toLowerCase().includes(valCNPJ)) match = false;
            const dataEmp = new Date(d['data do empenho']);
            if (inicio && new Date(inicio) > dataEmp) match = false;
            if (fim && new Date(fim) < dataEmp) match = false;
            return match;
          });

          if ($('#filtroAno').val()) filtrado = filtrado.filter(r => r['ano'] === $('#filtroAno').val());
          if ($('#filtroMes').val()) filtrado = filtrado.filter(r => r['mes'] === $('#filtroMes').val());
          if ($('#filtroUO').val()) filtrado = filtrado.filter(r => r['unidade orcamentaria'] === $('#filtroUO').val());

          const unicos = [...new Set(filtrado.map(d => d[campo]).filter(Boolean))].sort();
          const select = $('#' + id);
          const selecionado = select.val();
          select.empty().append('<option value="">Todos</option>');
          unicos.forEach(v => select.append(`<option value="${v}">${v}</option>`));
          if (unicos.includes(selecionado)) select.val(selecionado);
        }

        $('#filtroAno, #filtroMes, #filtroUO, #filtroEmpenho, #filtroCNPJ, #dataInicio, #dataFim').on('change keyup', function () {
          const filtros = {
            ano: $('#filtroAno').val(),
            mes: $('#filtroMes').val(),
            uo: $('#filtroUO').val(),
            empenho: $('#filtroEmpenho').val().toLowerCase(),
            cnpj: $('#filtroCNPJ').val().toLowerCase(),
            inicio: $('#dataInicio').val(),
            fim: $('#dataFim').val()
          };
          tabela.clear().rows.add(data.filter(d => {
            return (!filtros.ano || d['ano'] === filtros.ano)
              && (!filtros.mes || d['mes'] === filtros.mes)
              && (!filtros.uo || d['unidade orcamentaria'] === filtros.uo)
              && (!filtros.empenho || d['empenho'].toLowerCase().includes(filtros.empenho))
              && (!filtros.cnpj || d['cpf-cnpj'].toLowerCase().includes(filtros.cnpj))
              && (!filtros.inicio || new Date(d['data do empenho']) >= new Date(filtros.inicio))
              && (!filtros.fim || new Date(d['data do empenho']) <= new Date(filtros.fim));
          })).draw();
          atualizarFiltros();
        });

        $('#limparFiltros').on('click', function () {
          $('#filtros select, #filtros input').val('');
          tabela.clear().rows.add(data).draw();
          atualizarFiltros();
        });
      }
    });
  </script>
</body>
</html>
